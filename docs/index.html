<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="coOCR/HTR Workbench - Browser-based tool for historical document text recognition with expert-in-the-loop validation">
    <title>coOCR/HTR Workbench</title>

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/styles.css">

</head>

<body>

    <!-- Mobile Warning -->
    <div class="mobile-warning">
        <!-- Icon: Monitor -->
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"
            style="margin-bottom: 1rem; color: var(--text-secondary);">
            <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
            <line x1="8" y1="21" x2="16" y2="21"></line>
            <line x1="12" y1="17" x2="12" y2="21"></line>
        </svg>
        <h2>Desktop Recommended</h2>
        <p style="color: var(--text-secondary); max-width: 300px; margin: 1rem auto;">
            coOCR/HTR is optimized for large screens to display document, editor, and validation panels simultaneously.
        </p>
    </div>

    <div class="app-container">

        <!-- HEADER -->
        <header class="app-header glass">
            <div class="logo">
                <img src="assets/logo-icon.png" alt="coOCR/HTR Logo" class="logo-image">
                coOCR/HTR
            </div>

            <div class="header-doc-info" id="headerDocInfo" style="display: none;">
                <div class="status-indicator status-confident"></div>
                <span id="headerFilename" style="font-weight: 500; font-size: var(--text-sm);"></span>
            </div>

            <!-- Demo Indicator (shown when demo data is loaded) -->
            <div class="demo-indicator" id="demoIndicator" style="display: none;">
                <span class="demo-indicator-dot"></span>
                <span>DEMO</span>
            </div>

            <div class="header-controls">
                <!-- Samples Dropdown -->
                <div class="samples-dropdown">
                    <button class="btn btn-secondary" id="btnSamples">
                        <svg class="icon-sm" style="margin-right: 6px;" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                        </svg>
                        Demo
                    </button>
                    <div class="samples-menu" id="samplesMenu"></div>
                </div>

                <button class="btn btn-primary" id="btnUpload">
                    <svg class="icon-sm" style="margin-right: 6px;" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17 8 12 3 7 8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                    Upload
                </button>
                <button class="icon-btn icon-md" title="API Keys" id="btnApiKeys">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path
                            d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4">
                        </path>
                    </svg>
                </button>
                <button class="icon-btn icon-md" title="Export" id="btnExport">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                </button>
                <button class="icon-btn icon-md" title="Settings">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path
                            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                        </path>
                    </svg>
                </button>
                <a href="knowledge.html" class="icon-btn icon-md" title="Knowledge Base">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                        <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                    </svg>
                </a>
                <a href="help.html" class="icon-btn icon-md" title="Help">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                </a>
                <a href="about.html" class="icon-btn icon-md" title="About">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="16" x2="12" y2="12"></line>
                        <line x1="12" y1="8" x2="12.01" y2="8"></line>
                    </svg>
                </a>
            </div>
        </header>

        <!-- LEFT PANEL: DOCUMENT VIEWER -->
        <section class="panel glass-panel" style="grid-column: 1;">
            <div class="panel-header">
                <span>Document Viewer</span>
                <span class="info-tooltip">i
                    <div class="info-tooltip-content">
                        <div class="info-tooltip-title">Load Document</div>
                        Supports images (JPG, PNG) and PAGE-XML. Zoom with mouse wheel, pan by dragging.
                    </div>
                </span>
            </div>
            <!-- Panel Hint -->
            <div class="panel-hint" id="viewerHint">
                <svg class="panel-hint-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <path d="M12 16v-4"></path>
                    <path d="M12 8h.01"></path>
                </svg>
                <span>Load a demo document or upload an image (JPG, PNG) or PAGE-XML.</span>
                <button class="panel-hint-dismiss" data-dismiss-hint="viewer">×</button>
            </div>
            <div class="panel-content" style="background-color: var(--bg-viewer); position: relative; overflow: hidden;">
                <!-- Empty State with Drag & Drop (shown when no document loaded) -->
                <div class="viewer-empty-state" id="viewerEmptyState">
                    <div class="drop-zone-indicator">
                        <svg class="empty-state-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="17 8 12 3 7 8"></polyline>
                            <line x1="12" y1="3" x2="12" y2="15"></line>
                        </svg>
                        <h3 class="empty-state-title">Drop files here</h3>
                        <p class="empty-state-text">
                            Drag & drop images or PAGE-XML files
                        </p>
                        <span class="drop-formats">JPG, PNG, TIFF, XML</span>
                    </div>
                    <div class="empty-state-divider">
                        <span>or</span>
                    </div>
                    <div class="empty-state-actions">
                        <button class="btn btn-secondary btn-sm" id="btnLoadDemo">Load Demo</button>
                    </div>
                </div>

                <!-- Document Container (hidden until document loaded) -->
                <div class="image-container">
                    <div id="imageWrapper" style="display: none;">
                        <img src="" id="docImage" alt="Historical Document Page">
                        <!-- SVG Overlay for Regions - positioned relative to imageWrapper -->
                        <svg id="regionsOverlay" viewBox="0 0 100 100" preserveAspectRatio="none">
                            <!-- Regions will be added by JS -->
                        </svg>
                    </div>
                </div>

                <!-- Page Navigation (hidden for single-page documents) -->
                <div class="page-navigation" id="pageNavigation" style="display: none;">
                    <button class="icon-btn icon-sm" id="btnPrevPage" title="Previous Page" disabled>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <polyline points="15 18 9 12 15 6"></polyline>
                        </svg>
                    </button>
                    <span class="page-info" id="pageInfo">Page 1 / 1</span>
                    <button class="icon-btn icon-sm" id="btnNextPage" title="Next Page" disabled>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <polyline points="9 18 15 12 9 6"></polyline>
                        </svg>
                    </button>
                </div>

                <!-- Floating Toolbar -->
                <div class="viewer-toolbar glass">
                    <button class="icon-btn icon-sm" title="Zoom Out" id="zoomOut"><svg viewBox="0 0 24 24" fill="none"
                            stroke="currentColor">
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg></button>
                    <span class="btn btn-icon"
                        style="font-size: var(--text-xs); width: 40px; border:none; background:none;"
                        id="zoomLabel">100%</span>
                    <button class="icon-btn icon-sm" title="Zoom In" id="zoomIn"><svg viewBox="0 0 24 24" fill="none"
                            stroke="currentColor">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg></button>
                    <div class="divider-vertical"></div>
                    <button class="icon-btn icon-sm" title="Fit Width">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <polyline points="15 3 21 3 21 9"></polyline>
                            <polyline points="9 21 3 21 3 15"></polyline>
                            <line x1="21" y1="3" x2="14" y2="10"></line>
                            <line x1="3" y1="21" x2="10" y2="14"></line>
                        </svg>
                    </button>
                    <button class="icon-btn icon-sm" title="Fit Height">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M8 3v3a2 2 0 0 1-2 2H3"></path>
                            <path d="M21 8h-3a2 2 0 0 1-2-2V3"></path>
                            <path d="M3 16h3a2 2 0 0 1 2 2v3"></path>
                            <path d="M16 21v-3a2 2 0 0 1 2-2h3"></path>
                        </svg>
                    </button>
                    <button class="icon-btn icon-sm" title="Reset View">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="9" y1="9" x2="15" y2="15"></line>
                            <line x1="15" y1="9" x2="9" y2="15"></line>
                        </svg>
                    </button>
                </div>
            </div>
        </section>

        <!-- MIDDLE PANEL: EDITOR -->
        <section class="panel glass-panel" style="grid-column: 2;">
            <div class="panel-header">
                <span>Transcription</span>
                <span class="info-tooltip">i
                    <div class="info-tooltip-content">
                        <div class="info-tooltip-title">Co-Intelligence</div>
                        LLM provides fast recognition, expert brings judgment. Double-click to edit, Enter to save.
                    </div>
                </span>
                <div style="display: flex; gap: 4px; align-items: center; margin-left: auto;">
                    <select id="documentType" title="Document type for transcription" style="padding: 4px 8px; font-size: var(--text-xs); background: var(--bg-tertiary); border: 1px solid var(--border-default); border-radius: var(--radius-sm); color: var(--text-primary); cursor: pointer;">
                        <option value="table">Table</option>
                        <option value="text">Text</option>
                    </select>
                    <button class="btn btn-primary btn-sm" id="btnTranscribe" title="Transcribe document with LLM">
                        <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" style="margin-right: 4px;">
                            <path d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2z"></path>
                        </svg>
                        <span class="btn-text">Transcribe</span>
                        <span class="btn-spinner" style="display: none;">
                            <svg class="spinner" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <circle cx="12" cy="12" r="10" stroke-width="2" stroke-dasharray="32" stroke-linecap="round"></circle>
                            </svg>
                        </span>
                    </button>
                    <div style="width: 1px; height: 16px; background: var(--border-default); margin: 0 4px;"></div>
                    <button class="icon-btn icon-sm" id="btnUndo" title="Undo" disabled><svg viewBox="0 0 24 24" fill="none"
                            stroke="currentColor">
                            <path d="M9 14 4 9 9 4" />
                            <path d="M20 20v-7a4 4 0 0 0-4-4H4" />
                        </svg></button>
                    <button class="icon-btn icon-sm" id="btnRedo" title="Redo" disabled><svg viewBox="0 0 24 24" fill="none"
                            stroke="currentColor">
                            <path d="M4 20v-7a4 4 0 0 1 4-4h12" />
                            <path d="M15 4 20 9 15 14" />
                        </svg></button>
                </div>
            </div>
            <!-- Panel Hint -->
            <div class="panel-hint" id="editorHint">
                <svg class="panel-hint-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <path d="M12 16v-4"></path>
                    <path d="M12 8h.01"></path>
                </svg>
                <span>Click "Transcribe" to process the document with AI. Double-click to edit.</span>
                <button class="panel-hint-dismiss" data-dismiss-hint="editor">×</button>
            </div>
            <div class="panel-content editor-container" id="editorContent">
                <!-- Content injected by JS -->
            </div>
        </section>

        <!-- RIGHT PANEL: VALIDATION -->
        <section class="panel glass-panel" style="grid-column: 3;">
            <div class="panel-header">
                <span>Validation</span>
                <span class="info-tooltip">i
                    <div class="info-tooltip-content">
                        <div class="info-tooltip-title">Hybrid Validation</div>
                        Combines deterministic rules with LLM-Judge. Categories: confident / uncertain / problematic (no percentages).
                    </div>
                </span>
                <span class="badge" id="validationBadge"
                    style="background: var(--border-default); padding: 2px 6px; border-radius: 10px; font-size: 10px; color: var(--text-secondary); display: none; margin-left: auto;">0
                    Issues</span>
            </div>
            <!-- Panel Hint -->
            <div class="panel-hint" id="validationHint">
                <svg class="panel-hint-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <path d="M12 16v-4"></path>
                    <path d="M12 8h.01"></path>
                </svg>
                <span>Validation checks transcription for errors and uncertainties.</span>
                <button class="panel-hint-dismiss" data-dismiss-hint="validation">×</button>
            </div>
            <div class="panel-content" id="validationContent">
                <!-- Empty State -->
                <div class="validation-empty-state" id="validationEmptyState">
                    <svg class="empty-state-icon" style="width: 48px; height: 48px; margin-bottom: var(--space-3);" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M9 12l2 2 4-4"></path>
                        <path d="M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0z"></path>
                    </svg>
                    <h4 style="color: var(--text-primary); margin-bottom: var(--space-2);">No Validation Yet</h4>
                    <p style="color: var(--text-secondary); font-size: var(--text-xs); max-width: 200px; text-align: center;">
                        Load a document and run transcription to see validation results here.
                    </p>
                </div>

                <!-- Rule-Based Section (hidden until content) -->
                <div class="validation-section" id="ruleBasedSection" style="display: none;">
                    <div class="section-title" style="display:flex; align-items:center; gap:6px;">
                        <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path
                                d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                            </path>
                        </svg>
                        Rule-Based
                    </div>
                    <div id="ruleBasedContent">
                        <!-- Content injected by JS -->
                    </div>
                </div>

                <!-- AI Assistant Section (hidden until content) -->
                <div class="validation-section" id="aiAssistantSection" style="display: none;">
                    <div class="section-title" style="display:flex; align-items:center; gap:6px;">
                        <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path
                                d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2z">
                            </path>
                        </svg>
                        AI Assistant
                    </div>
                    <div id="aiAssistantContent">
                        <!-- Content injected by JS -->
                    </div>
                </div>

            </div>
        </section>

        <!-- STATUS BAR -->
        <footer class="status-bar glass">
            <!-- Workflow Stepper -->
            <div class="workflow-stepper" id="workflowStepper">
                <div class="workflow-step active" data-step="1">
                    <span class="workflow-step-number">I</span>
                    <span>Load</span>
                </div>
                <span class="workflow-step-arrow">→</span>
                <div class="workflow-step" data-step="2">
                    <span class="workflow-step-number">II</span>
                    <span>Transcribe</span>
                </div>
                <span class="workflow-step-arrow">→</span>
                <div class="workflow-step" data-step="3">
                    <span class="workflow-step-number">III</span>
                    <span>Validate</span>
                </div>
                <span class="workflow-step-arrow">→</span>
                <div class="workflow-step" data-step="4">
                    <span class="workflow-step-number">IV</span>
                    <span>Export</span>
                </div>
            </div>

            <div style="display: flex; align-items: center; gap: var(--space-4);">
                <span id="statusProvider">Model: <span style="color: var(--text-primary);">Gemini 3 Flash</span></span>
                <div class="status-indicator status-confident" title="API Connected" id="statusIndicator"></div>
            </div>
        </footer>

    </div>

    <!-- DIALOGS -->

    <!-- API Key Dialog -->
    <dialog id="apiKeyDialog" class="dialog">
        <div class="dialog-header">
            <h2 class="dialog-title">API Configuration</h2>
            <button class="dialog-close" data-close-dialog aria-label="Close">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>

        <div class="dialog-tabs" role="tablist">
            <button class="dialog-tab active" role="tab" data-provider="gemini" aria-selected="true">
                Gemini
                <span class="provider-status" data-status="unconfigured"></span>
            </button>
            <button class="dialog-tab" role="tab" data-provider="openai" aria-selected="false">
                OpenAI
                <span class="provider-status" data-status="unconfigured"></span>
            </button>
            <button class="dialog-tab" role="tab" data-provider="anthropic" aria-selected="false">
                Anthropic
                <span class="provider-status" data-status="unconfigured"></span>
            </button>
            <button class="dialog-tab" role="tab" data-provider="deepseek" aria-selected="false">
                DeepSeek
                <span class="provider-status" data-status="unconfigured"></span>
            </button>
            <button class="dialog-tab" role="tab" data-provider="ollama" aria-selected="false">
                Ollama
                <span class="provider-status" data-status="unconfigured"></span>
            </button>
        </div>

        <div class="dialog-body">
            <!-- Gemini Panel -->
            <div class="dialog-tab-panel active" data-panel="gemini" role="tabpanel">
                <p class="provider-description">
                    Google Gemini API. Get your API key from
                    <a href="https://aistudio.google.com/apikey" target="_blank" rel="noopener">Google AI Studio</a>.
                </p>
                <div class="input-wrapper">
                    <label for="geminiApiKey">API Key</label>
                    <div class="input-with-toggle">
                        <input type="password" id="geminiApiKey" placeholder="AIza..." autocomplete="off">
                        <button type="button" class="toggle-visibility" data-toggle-password aria-label="Toggle visibility">
                            <svg class="icon-show" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                            <svg class="icon-hide" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none">
                                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                                <line x1="1" y1="1" x2="23" y2="23"></line>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="input-wrapper">
                    <label for="geminiModel">Model</label>
                    <select id="geminiModel">
                        <option value="gemini-3-flash-preview" selected>Gemini 3 Flash (Recommended)</option>
                        <option value="gemini-3-pro-preview">Gemini 3 Pro</option>
                    </select>
                </div>
            </div>

            <!-- OpenAI Panel -->
            <div class="dialog-tab-panel" data-panel="openai" role="tabpanel" hidden>
                <p class="provider-description">
                    OpenAI API. Get your API key from
                    <a href="https://platform.openai.com/api-keys" target="_blank" rel="noopener">OpenAI Platform</a>.
                </p>
                <div class="input-wrapper">
                    <label for="openaiApiKey">API Key</label>
                    <div class="input-with-toggle">
                        <input type="password" id="openaiApiKey" placeholder="sk-..." autocomplete="off">
                        <button type="button" class="toggle-visibility" data-toggle-password aria-label="Toggle visibility">
                            <svg class="icon-show" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                            <svg class="icon-hide" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none">
                                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                                <line x1="1" y1="1" x2="23" y2="23"></line>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="input-wrapper">
                    <label for="openaiModel">Model</label>
                    <select id="openaiModel">
                        <option value="gpt-4o-mini" selected>GPT-4o Mini (Recommended)</option>
                        <option value="gpt-4o">GPT-4o</option>
                        <option value="gpt-4-turbo">GPT-4 Turbo</option>
                    </select>
                </div>
            </div>

            <!-- Anthropic Panel -->
            <div class="dialog-tab-panel" data-panel="anthropic" role="tabpanel" hidden>
                <p class="provider-description">
                    Anthropic Claude API. Get your API key from
                    <a href="https://console.anthropic.com/settings/keys" target="_blank" rel="noopener">Anthropic Console</a>.
                </p>
                <div class="input-wrapper">
                    <label for="anthropicApiKey">API Key</label>
                    <div class="input-with-toggle">
                        <input type="password" id="anthropicApiKey" placeholder="sk-ant-..." autocomplete="off">
                        <button type="button" class="toggle-visibility" data-toggle-password aria-label="Toggle visibility">
                            <svg class="icon-show" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                            <svg class="icon-hide" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none">
                                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                                <line x1="1" y1="1" x2="23" y2="23"></line>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="input-wrapper">
                    <label for="anthropicModel">Model</label>
                    <select id="anthropicModel">
                        <option value="claude-3-5-haiku-latest" selected>Claude 3.5 Haiku (Recommended)</option>
                        <option value="claude-3-5-sonnet-latest">Claude 3.5 Sonnet</option>
                        <option value="claude-3-opus-latest">Claude 3 Opus</option>
                    </select>
                </div>
            </div>

            <!-- DeepSeek Panel -->
            <div class="dialog-tab-panel" data-panel="deepseek" role="tabpanel" hidden>
                <p class="provider-description">
                    DeepSeek API. Get your API key from
                    <a href="https://platform.deepseek.com/api_keys" target="_blank" rel="noopener">DeepSeek Platform</a>.
                </p>
                <div class="input-wrapper">
                    <label for="deepseekApiKey">API Key</label>
                    <div class="input-with-toggle">
                        <input type="password" id="deepseekApiKey" placeholder="sk-..." autocomplete="off">
                        <button type="button" class="toggle-visibility" data-toggle-password aria-label="Toggle visibility">
                            <svg class="icon-show" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                            <svg class="icon-hide" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none">
                                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                                <line x1="1" y1="1" x2="23" y2="23"></line>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="input-wrapper">
                    <label for="deepseekModel">Model</label>
                    <select id="deepseekModel">
                        <option value="deepseek-chat" selected>DeepSeek Chat</option>
                        <option value="deepseek-coder">DeepSeek Coder</option>
                    </select>
                </div>
                <p class="provider-note">
                    Note: DeepSeek API does not support vision. Use Ollama with DeepSeek-VL for image transcription.
                </p>
            </div>

            <!-- Ollama Panel -->
            <div class="dialog-tab-panel" data-panel="ollama" role="tabpanel" hidden>
                <p class="provider-description">
                    Local LLM via Ollama. Install from
                    <a href="https://ollama.com" target="_blank" rel="noopener">ollama.com</a>
                    and run <code>ollama serve</code>.
                </p>
                <div class="input-wrapper">
                    <label for="ollamaEndpoint">Endpoint</label>
                    <input type="text" id="ollamaEndpoint" value="http://localhost:11434" placeholder="http://localhost:11434">
                </div>
                <div class="input-wrapper">
                    <label for="ollamaModel">Model</label>
                    <div class="input-with-button">
                        <input type="text" id="ollamaModel" value="llava" placeholder="llava">
                        <button type="button" class="btn btn-secondary" id="ollamaRefreshModels">Refresh</button>
                    </div>
                </div>
                <div class="provider-note">
                    Recommended models for vision: <code>llava</code>, <code>llava:13b</code>, <code>bakllava</code>
                </div>
            </div>
        </div>

        <div class="dialog-footer">
            <button type="button" class="btn btn-secondary" id="testApiConnection">Test Connection</button>
            <div class="dialog-actions">
                <button type="button" class="btn btn-secondary" data-close-dialog>Cancel</button>
                <button type="button" class="btn btn-primary" id="saveApiKeys">Save</button>
            </div>
        </div>
    </dialog>

    <!-- Export Dialog -->
    <dialog id="exportDialog" class="dialog">
        <div class="dialog-container">
            <div class="dialog-header">
                <h2 class="dialog-title">Export Transcription</h2>
                <button class="dialog-close" data-close-dialog aria-label="Close">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>

            <div class="dialog-body">
                <div class="export-formats">
                    <label class="export-format-option">
                        <input type="radio" name="exportFormat" value="txt" checked>
                        <div class="format-card">
                            <span class="format-icon">TXT</span>
                            <div class="format-info">
                                <span class="format-name">Plain Text</span>
                                <span class="format-desc">Tab-separated values, simple and portable</span>
                            </div>
                        </div>
                    </label>

                    <label class="export-format-option">
                        <input type="radio" name="exportFormat" value="json">
                        <div class="format-card">
                            <span class="format-icon">JSON</span>
                            <div class="format-info">
                                <span class="format-name">JSON</span>
                                <span class="format-desc">Full data with metadata and validation</span>
                            </div>
                        </div>
                    </label>

                    <label class="export-format-option">
                        <input type="radio" name="exportFormat" value="md">
                        <div class="format-card">
                            <span class="format-icon">MD</span>
                            <div class="format-info">
                                <span class="format-name">Markdown</span>
                                <span class="format-desc">Formatted table with validation notes</span>
                            </div>
                        </div>
                    </label>

                    <label class="export-format-option">
                        <input type="radio" name="exportFormat" value="xml">
                        <div class="format-card">
                            <span class="format-icon">XML</span>
                            <div class="format-info">
                                <span class="format-name">PAGE-XML</span>
                                <span class="format-desc">Standard format for Transkribus and other HTR tools</span>
                            </div>
                        </div>
                    </label>
                </div>

                <div class="export-options">
                    <label class="checkbox-wrapper">
                        <input type="checkbox" id="exportIncludeValidation" checked>
                        <span>Include validation results</span>
                    </label>
                    <label class="checkbox-wrapper">
                        <input type="checkbox" id="exportIncludeMetadata">
                        <span>Include metadata (timestamp, provider, model)</span>
                    </label>
                </div>
            </div>

            <div class="dialog-footer">
                <div class="dialog-actions">
                    <button type="button" class="btn btn-secondary" data-close-dialog>Cancel</button>
                    <button type="button" class="btn btn-primary" id="downloadExport">
                        <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" style="margin-right: 6px;">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7 10 12 15 17 10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                        Download
                    </button>
                </div>
            </div>
        </div>
    </dialog>

    <!-- Settings Dialog -->
    <dialog id="settingsDialog" class="dialog">
        <div class="dialog-header">
            <h2 class="dialog-title">Settings</h2>
            <button class="dialog-close" data-close-dialog aria-label="Close">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>

        <div class="dialog-body">
            <!-- Editor Settings -->
            <div class="settings-section">
                <h3 class="settings-section-title">Editor</h3>
                <label class="checkbox-wrapper">
                    <input type="checkbox" id="settingAutoSave" checked>
                    <span>Auto-save session (every 30s)</span>
                </label>
                <label class="checkbox-wrapper">
                    <input type="checkbox" id="settingShowLineNumbers" checked>
                    <span>Show line numbers</span>
                </label>
                <label class="checkbox-wrapper">
                    <input type="checkbox" id="settingHighlightUncertain" checked>
                    <span>Highlight uncertain readings</span>
                </label>
            </div>

            <!-- Validation Settings -->
            <div class="settings-section">
                <h3 class="settings-section-title">Validation</h3>
                <label class="checkbox-wrapper">
                    <input type="checkbox" id="settingAutoValidate">
                    <span>Auto-validate after transcription</span>
                </label>
                <div class="input-wrapper">
                    <label for="settingDefaultPerspective">Default Perspective</label>
                    <select id="settingDefaultPerspective">
                        <option value="paleographic">Paleographic</option>
                        <option value="linguistic">Linguistic</option>
                        <option value="structural">Structural</option>
                        <option value="domain">Domain Knowledge</option>
                    </select>
                </div>
            </div>

            <!-- Display Settings -->
            <div class="settings-section">
                <h3 class="settings-section-title">Display</h3>
                <label class="checkbox-wrapper">
                    <input type="checkbox" id="settingShowHints" checked>
                    <span>Show panel hints for new users</span>
                </label>
                <label class="checkbox-wrapper">
                    <input type="checkbox" id="settingShowWorkflow" checked>
                    <span>Show workflow stepper</span>
                </label>
            </div>

            <!-- Data Management -->
            <div class="settings-section">
                <h3 class="settings-section-title">Data</h3>
                <div class="settings-actions">
                    <button type="button" class="btn btn-secondary" id="btnClearSession">
                        <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" style="margin-right: 6px;">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        </svg>
                        Clear Session
                    </button>
                    <button type="button" class="btn btn-secondary" id="btnResetSettings">
                        <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" style="margin-right: 6px;">
                            <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path>
                            <path d="M3 3v5h5"></path>
                        </svg>
                        Reset to Defaults
                    </button>
                </div>
            </div>
        </div>

        <div class="dialog-footer">
            <div class="dialog-actions">
                <button type="button" class="btn btn-secondary" data-close-dialog>Cancel</button>
                <button type="button" class="btn btn-primary" id="saveSettings">Save Settings</button>
            </div>
        </div>
    </dialog>

    <!-- Help Dialog -->
    <dialog id="helpDialog" class="dialog dialog-wide">
        <div class="dialog-header">
            <h2 class="dialog-title">Help & Documentation</h2>
            <button class="dialog-close" data-close-dialog aria-label="Close">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>

        <div class="dialog-body">
            <!-- Quick Start -->
            <div class="help-section">
                <h3 class="help-section-title">
                    <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polygon points="10 8 16 12 10 16 10 8"></polygon>
                    </svg>
                    Quick Start
                </h3>
                <ol class="help-steps">
                    <li><strong>Load</strong> – Upload an image or load a demo document</li>
                    <li><strong>Transcribe</strong> – Click "Transcribe" to process with AI</li>
                    <li><strong>Validate</strong> – Review rule-based and AI suggestions</li>
                    <li><strong>Export</strong> – Download as TXT, JSON, or Markdown</li>
                </ol>
            </div>

            <!-- Keyboard Shortcuts -->
            <div class="help-section">
                <h3 class="help-section-title">
                    <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <rect x="2" y="4" width="20" height="16" rx="2" ry="2"></rect>
                        <path d="M6 8h.001"></path>
                        <path d="M10 8h.001"></path>
                        <path d="M14 8h.001"></path>
                        <path d="M18 8h.001"></path>
                        <path d="M8 12h.001"></path>
                        <path d="M12 12h.001"></path>
                        <path d="M16 12h.001"></path>
                        <path d="M7 16h10"></path>
                    </svg>
                    Keyboard Shortcuts
                </h3>
                <div class="shortcut-grid">
                    <div class="shortcut-item">
                        <kbd>Ctrl</kbd> + <kbd>Z</kbd>
                        <span>Undo</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>Z</kbd>
                        <span>Redo</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>↑</kbd> <kbd>↓</kbd>
                        <span>Navigate lines</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Enter</kbd>
                        <span>Edit selected cell</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Escape</kbd>
                        <span>Cancel editing</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Tab</kbd>
                        <span>Next cell (grid mode)</span>
                    </div>
                </div>
            </div>

            <!-- Confidence Markers -->
            <div class="help-section">
                <h3 class="help-section-title">
                    <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"></path>
                        <path d="M12 6v6l4 2"></path>
                    </svg>
                    Confidence Markers
                </h3>
                <div class="marker-legend">
                    <div class="marker-item">
                        <span class="marker-indicator confident"></span>
                        <span><strong>Confident</strong> – High certainty reading</span>
                    </div>
                    <div class="marker-item">
                        <span class="marker-indicator uncertain"></span>
                        <span><strong>Uncertain</strong> – Needs expert review</span>
                    </div>
                    <div class="marker-item">
                        <span class="marker-indicator problematic"></span>
                        <span><strong>Problematic</strong> – Likely error or illegible</span>
                    </div>
                </div>
                <p class="help-note">
                    Use <code>[?]</code> for uncertain readings and <code>[illegible]</code> for unreadable text.
                </p>
            </div>

            <!-- About -->
            <div class="help-section help-about">
                <div class="about-banner">
                    <img src="assets/logo.png" alt="coOCR/HTR" class="about-logo-wide">
                </div>
                <div class="about-header">
                    <div class="about-info">
                        <h3 class="about-title">coOCR/HTR Workbench</h3>
                        <p class="about-version">Version 2.1 &middot; Editorial Design</p>
                    </div>
                </div>
                <p class="about-tagline">Expert-in-the-loop validation for historical document transcription</p>
            </div>

            <!-- Resources -->
            <div class="help-section">
                <h3 class="help-section-title">
                    <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                        <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                    </svg>
                    Resources
                </h3>
                <div class="help-links">
                    <a href="https://github.com/DigitalHumanitiesCraft/co-ocr-htr" target="_blank" class="help-link">
                        <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
                        </svg>
                        GitHub Repository
                    </a>
                    <a href="https://github.com/DigitalHumanitiesCraft/co-ocr-htr/tree/main/knowledge" target="_blank" class="help-link">
                        <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                            <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                        </svg>
                        Knowledge Vault
                    </a>
                    <a href="https://github.com/DigitalHumanitiesCraft/co-ocr-htr/blob/main/knowledge/METHODOLOGY.md" target="_blank" class="help-link">
                        <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                            <line x1="12" y1="17" x2="12.01" y2="17"></line>
                        </svg>
                        Methodology
                    </a>
                </div>
            </div>
        </div>

        <div class="dialog-footer">
            <div class="dialog-actions">
                <button type="button" class="btn btn-primary" data-close-dialog>Got it!</button>
            </div>
        </div>
    </dialog>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- SCRIPTS -->
    <script type="module" src="js/main.js"></script>
</body>

</html>